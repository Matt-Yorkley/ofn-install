--- # Can be simplified when https://github.com/geerlingguy/ansible-role-postgresql/pull/31 is included in a release...

- import_role:
    name: geerlingguy.postgresql

- include_role:
    name: geerlingguy.postgresql
    tasks_from: variables
    apply:
      delegate_to: "{{ postgres_delegate_host }}"

- include_role:
    name: geerlingguy.postgresql
    tasks_from: initialize
    apply:
      delegate_to: "{{ postgres_delegate_host }}"
      become: yes
      become_user: root

- include_role:
    name: geerlingguy.postgresql
    tasks_from: configure
    apply:
      delegate_to: "{{ postgres_delegate_host }}"

- include_role:
    name: geerlingguy.postgresql
    tasks_from: users
  vars:
    postgresql_user: postgres
    postgresql_users:
      - name: "{{ db_user }}"
        login_host: "{{ postgres_module_login_host }}"
        password: "{{ db_password }}"
        role_attr_flags: "{{ db_user_roles }}"

- include_role:
    name: geerlingguy.postgresql
    tasks_from: databases
  vars:
    postgresql_user: postgres
    postgresql_databases:
      - name: "{{ db }}"
        owner: "{{ db_user }}"
        login_host: "{{ db_host }}"
        login_password: "{{ db_password }}"
        lc_collate: "{{ postgres_encoding }}"
        lc_ctype: "{{ postgres_encoding }}"
